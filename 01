增强现实中虚实遮挡技术的研究现状
作者： 聂平
　　摘要：增强现实是一种将虚拟现实技术运用在真实坏境上的新技术，其中虚拟物体和真实物体遮挡关系的正确表现对提高用户的真实感起到了关键的作用。概述了增强现实中虚实遮挡技术的发展历程，从基于深度计算和三维重建2个方向介绍了国内外研究者对虚实遮挡处理的研究，其中详细介绍了基于深度计算的方法，针对遮挡物获取、深度恢复和剔除效果处理3个主要步骤，分别对其基本原理和相关改进进行了说明。得到解决虚实遮挡问题的一般流程，并从2种角度对比了各种算法的优缺点。最后对虚实遮挡技术的发展给出了总结和建议。 
　　关键词：增强现实；虚实遮挡；三维重建；几何一致性 
　　中图分类号：TP391.41文献标识码：A文章编号：1005-3824（2013）05-0034-04 
　　0引言 
　　增强现实[1]（augmented reality， AR）是虚拟现实技术的一个发展分支，与虚拟现实不同，它借助计算机图像处理技术和虚拟现实技术将计算机生成的虚拟信息和图像采集装置（摄像机）捕获的真实自然场景叠加到一起，从而增强了用户对自然环境的感受。它的应用领域囊括了医疗、工业制造维修、娱乐和军事等。 
　　如果画面中真实物体和虚拟物体之间的遮挡关系不正确，不仅会使用户出现位置上的判断错误，而且会出现视觉疲劳，甚至在一些重要的领域会导致严重的后果。如图1a所示，当瓶子出现在虚拟茶壶前面时，错误的遮挡关系会让人觉得瓶子在茶壶的后方，而b才是正确的显示效果。所以虚实遮挡对于提高增强现实的真实感起到了很重要的作用，同时它也是增强现实中的热点和难点问题。 
　　1虚实遮挡算法的发展概述 
　　在早期的增强现实中，真实场景都是作为虚拟物体的背景而出现的，所以无论真实场景中的遮挡物体怎么移动，它都出现在虚拟物体的后面。随着相关技术（如图形图像技术，三维渲染技术等）的不断发展，研究人员开始从各个角度来解决虚实遮挡的问题。总体来说这些方法分为基于三维重建和基于深度计算。 
　　1.1基于三维重建的方法 
　　基于三维重建的方法都是建立在对真实场景充分了解的基础上，其中Fuhrmann[2]提出了一种基于经验的三维重建方法，他充分采集真实环境的信息，包括深度信息，放置位置，大小形状等，然后对真实物体进行建模，因为真实物体的各种属性都是已知的，避免了各种计算过程，所以处理速度较快，但是由于前期建模难度较大，所以只适用于比较简单的场景，而且也不能用于动态坏境中。另外，Wloka[3]通过双目视觉技术来对真实物体进行三维建模来解决遮挡问题，简单说就是标定摄像机，然后利用2个二维图像的信息进行三维重建。 
　　由于基于三维重建的方式都要对真实物体进行模型建立工作，所以当真实物体较为复杂的时候，建模过程就变得异常复杂，这也限制了基于三维重建方法在虚实遮挡中的应用，不过这类方法最大的优点是可以处理产生形变的物体（非刚性物体），总之三维重建的方法只适用于简单静态的环境，如果场景太复杂，计算会过大而影响到了系统的实时性。 
　　1.2基于深度计算的方法 
　　与基于三维重建时需要事前做大量的建模工作不同，基于深度计算的算法不需要事先采集遮挡物的详细信息，可以在应用中动态的捕获未知遮挡物。所以这类方法的关键是如何获取遮挡物轮廓和恢复遮挡物深度信息。 
　　1.2.1遮挡物获取 
　　Stricker[4]等首先采用图像处理的相关技术，将遮挡物放置于纯色环境中，然后用图像裁剪算法获取遮挡物，此方法对场景要求太过特殊但相对于模型重建却改进了不少，此后不断有研究者改善裁剪算法，以便能在更复杂的环境下获取遮挡物，如Jurriaan[5]利用背景裁剪的技术获取遮挡物，如图2所示，a图是当前图片，b图是预记录的背景图片，2种图片裁剪后就得到了遮挡物的图像，Mulder[6]对视频流中相邻的帧进行裁剪，也获取到了运动的遮挡物，此后不少学者继续对该类方法进行优化和改进，但是这类方法都要求在一个固定的场景中进行。 
　　此外，也有学者提出从另一个角度来获取遮挡物。Berger[7]等首先利用单目视觉技术来提取遮挡物的轮廓并恢复出遮挡面，康波[8]和俞文炯[9]等利用在遮挡物表面贴标识物和预定义遮挡物顶点的方式快速找到遮挡物轮廓。这类方法都采用了单目视觉技术来识别和跟踪遮挡物，这类方法的缺点是只能将遮挡物看成一个平面物体，在视角变化的时候，由于遮挡物形态发生变化，所以在处理非刚性遮挡物方面存在很大的缺点。作者在另一篇论文中提出的根据摄像机姿态动态变化遮挡物匹配特征能有效解决这类方法的缺点。图3为康波等人采用标识提取遮挡物算法的示意图。 
　　1.2.2深度恢复 
　　从目前的研究文献来看，在计算遮挡物深度上，研究者根据不同的摄像机类型采用不同的算法，下面将从双目摄像机和单目摄像机2种视频采集装备上说明与之相应的算法。 
　　1）双目摄像机。 
　　随着硬件设施的不断发展，如图4所示的Kinect等一系列双目立体式摄像机开始出现在市场上，研究者们开始利用立体视觉原理和三角几何图形学来获取遮挡物的深度信息。 
　　下面将简单介绍利用双目立体几何学获取遮挡物深度信息的原理，如图5所示。 
　　假设空间点P=（X，Y，Z）在左右摄像机成像平面上的投影点分别为Pl=（xl，yl）和Pr=（xr，yr），这3点所确定的平面我们称其为极线平面，如果系统满足规范结构且左右摄像机内部参数相同，我们由三角几何关系可以得到空间点的深度值计算如下。Z=fBxr-xl（1）式（1）中：f为焦距；B为基线长度，所以场景中空间点的深度恢复可以通过计算对应点的视觉差值（xr-xl）来完成。 
　　此后学者都是在该原理上进行相关算法的改进和优化，以达到精确度和速度上的改善。如刘莉[10]采用基于极线约束的方法提高了搜索空间点在成像平面上投影坐标的速度，倪剑[11]等运用透视投影原理和极线几何理论对图像进行矫正，同样也提高了速度。 　　2）单目摄像机。 
　　基于深度的算法也能通过一个摄像机完成虚实处理，这种方法大都是和注册算法结合起来实现的。ARToolKit[12]是一个快速实现增强现实的函数库，它通过对一个简单标识的识别和跟踪以达到快速注册的目的。研究者将真实遮挡物贴上标识，这样遮挡物的深度信息其实就等于标识物所在平面在摄像机坐标系中Z轴上的值。我们设定标识物的坐标系（Xm，Ym，Zm）到摄像机坐标系（Xc，Yc，Zc）的变换矩阵为Tmc，所以2个坐标系之间的映射过程如公式（2）所示，其中rij对应坐标的旋转信息，ti对应坐标平移信息。由此我们就可以得到标识物所在平面点的坐标值在摄像机坐标系中的三维坐标。Xc 
　　1（3）这样，遮挡物和虚拟物体就统一到同一个坐标系下，我们就可以根据视点判断其三维坐标的差值而确定遮挡关系。 
　　单目摄像机解决虚实遮挡问题还有另外一种方法，张岩[13]等通过从几个不同角度对遮挡物拍摄图片利用多视图几何原理获得虚实遮挡的解决方法，但是这方法的实质其实同双目摄像机是一样的。 
　　1.3渲染算法的改进 
　　为了提高虚实遮挡的处理速度，一些学者优化了遮挡剔取过程，传统的剔除方法是将遮挡物像素和虚拟物体的深度进行逐一对比，然后选择进行渲染，这种算法虽然精确度很高，但是由于要对每一个像素都要处理，所以计算量偏大，适合处理那些形状不规则的遮挡物。王红，周雅等人[14]利用OpenGL绘制一个虚拟网格遮挡平面来实现真实物体被遮挡的效果，这种方式无需处理虚拟物体本身，而是直接在虚拟物体的前面绘制出一块遮挡平面，并分成若干个网格，这样就减少了比较的次数。俞文炯[9]等人对虚拟物体的组成结构三角面片进行重构处理，也实现了遮挡的效果。康波[8]等人利用了OpenGL中的帧缓存技术，在模板缓存中生成遮挡面模板也实现了虚拟物体的遮挡效果。 
　　由上可见，随着模型渲染技术的不断提高，在虚拟物体的剔除算法上仍有改进的空间。 
　　2算法对比 
　　通过以上方法的介绍，我们可以得到解决增强现实中虚实遮挡的一般流程，如图6所示。 
　　图6虚实遮挡一般流程图基于三维重建的算法用较复杂的预处理过程避免了前两步的过程，所以在算法过程中速度较快。而基于深度计算的所有方法其实都是针对中间三步的新策略或者改进，表1表述的是基于三维重建和基于深度计算的算法对比，表2描述的是不同摄像机之间的算法对比。表1基于三维重建和深度计算的优缺点对比表方法优点缺点基于三 
　　维重建1.速度快 
　　2.可以使用普通摄像机1.预处理工作量大 
　　2.只能在布置好的静态简单环境中进行基于深 
　　度计算1.不需要预先知道遮挡物信息 
　　2.能应对静动态遮挡物以及较为复杂的环境1.需要计算出遮挡物轮廓，深度信息，较为复杂 
　　表2视频采集装置不同的特点对比方法优点缺点双目 
　　摄像机能应对更为复杂的情况，预处理阶段的工作量更少需要特殊的摄像机，比如立体摄像机，HMD或者Kinect等普通 
　　摄像机对摄像机无特殊要求，处理过程较简单需要特殊标识来标定摄像机，以恢复遮挡物深度 
　　由上对比可得出，不同方法不同环境甚至不同设备在解决虚实遮挡问题上都有各自的特点，我们应该针对不同的应用环境采取不同的算法，比如室内环境较为简单，我们可以选用基于三维重建的方法，室外环境较为复杂我们可以选用基于深度的方法；同样按照对摄像机有无特殊需求，我们也可以采取不同的方法来实现虚实遮挡。 
　　3总结 
　　增强现实中的虚实遮挡处理是提高场景真实感最重要的元素之一。虚实遮挡功能可以让增强现实技术得到更广泛的应用。本文从不同角度分析了增强现实中虚实遮挡的处理方法，由上文分析可以看出，虽然方法众多，但是都有各自的优缺点，没有一种方法能从根本上解决问题。所以我们在选取具体算法时，应该充分考虑应用的特点和环境，这样才能选取到最合适的方法。直到现在，增强现实中真实物体和虚拟物体的无缝结合，尤其是虚实遮挡问题仍然是增强现实应用中的研究热点。 
　　参考文献： 
　　[1]AZUMA R T. A survey of augmented reality[R]. In Presence： Teleoperators and Virtual Environments， 1997， 6（4）：355385. 
　　[2]FUHRMANN A， HESINA G， FAURE F， et al. Occlusion in collaborative augmented environments[J]. Computers & Graphics， 1998，23（6）：809819. 
　　[3]WLOKA M， ANDERSON B. Resolving occlusion in augmented reality [C]// Symposium on Interactive 3D Graphics， 1995. USA： ACM Press， 1995： 512. 
　　[4]STRICKER D， KLINKER G， REINERS D. A fast and robust linebased optical tracker for augmented reality applications [C]// First International Workshop on Augmented Reality， 1998. USA： A.K. Peters， Ltd， 1998： 129145. 
　　[5]JURRIAAN D， MULDE R. Realistic occlusion effects in mirrorbased colocated augmented reality systems[C]// IEEE International Conferece on Information Science and Digital Content Technology， 2012.USA：IEEE，2012：2628. 
　　[6]MULDER J. Realistic occlusion effects in mirrorbased colocated augmented reality systems [C]// IEEE Virtual Reality Conference， 2005. USA： IEEE， 2005： 203208. 
　　[7]BERGER M O. Resolving occlusion in augmented reality： a contour based approach without 3D reconstruction [C]// IEEE International Conference on Computer Vision and Pattern Recognition， 1997. USA： IEEE， 1997： 9196. 
　　[8]康波， 苏宏.一种增强现实虚实遮挡的实时处理方法[J].系统仿真学报，2010，22（5）：11741177. 
　　[9]俞文炯， 何汉武， 吴悦明.增强现实环境下虚实物体遮挡判断方法研究[J].计算机应用研究，2009，26（9）：32703273. 
　　[10]刘莉.增强现实中基于轮廓深度恢复的虚实遮挡方法研究[J].计算机应用与软件，2011，28（1）：220222，245. 
　　[11]倪剑， 闫达远， 周雅， 等.增强现实系统中的深度检测技术研究[J].计算机应用，2006，26（1）：132134，137. 
　　[12]ARToolKit[EB/OL].（20060520）[20130309].http：//www.hitl.washington.edu/artoolkit/. 
　　[13]张岩，何晓波，管涛.基于多视图几何的位置与遮挡一致性恢复方法研究[J].工程图学学报，2011（1）：111118. 
　　[14]王红，周雅，马晋涛，等.光学透视式增强现实显示系统虚实遮挡问题研究[J].中国图象图形学报，2008（8）：15661569. 

